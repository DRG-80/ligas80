<app-header></app-header>

<div class="container mt-5 mb-5">

  <h2 class="text-center mb-4">Mis Ligas</h2>


  <div class="d-flex justify-content-end mb-3">
    <button type="button" class="btn btn-nuevaLiga" data-bs-toggle="modal" data-bs-target="#modalCrearLiga">
      <i class="bi bi-plus-lg"></i> Nueva Liga
    </button>
  </div>

  <div class="card shadow p-4">
    <div class="table-responsive">
      <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table table-striped table-bordered row-border hover w-100 tabla-mis-ligas">


        <thead class="thead-corporativo">
        <tr>
          <th>Nombre de la Liga</th>
          <th>Nº Equipos</th>
          <th class="text-center">Jornada</th>
          <th class="text-center" style="width: 200px;">Acciones</th>
        </tr>
        </thead>

        <tbody>
        <tr *ngFor="let l of ligas">

          <td class="fw-bold" style="color: #FF383C; vertical-align: middle;">{{ l.nombre }}</td>
          <td class="fw-bold" style="color: #FF383C; vertical-align: middle;">{{ l.n_equipos }}</td>

          <td class="text-center" style="vertical-align: middle;">{{ l.jornada || 0 }}</td>


          <td class="text-center">


            <button class="btn btn-success btn-md me-1"
                    title="Añadir Equipos"
                    data-bs-toggle="modal"
                    data-bs-target="#modalAddEquipos"
                    (click)="abrirModalEquipos(l)">
              <i class="bi bi-people-fill"></i>
            </button>


            <button class="btn btn-primary btn-sm me-1"
                    [title]="l.n_equipos < 20 ? 'Faltan equipos (Necesitas 20)' : 'Jugar'"
                    [routerLink]="l.n_equipos >= 20 ? '/ligasJuego/' + l.id : null"
                    [disabled]="l.n_equipos < 20">
              <i class="bi bi-play-fill"></i>
            </button>

            <button class="btn btn-warning btn-md me-1"
                    title="Modificar"
                    data-bs-toggle="modal"
                    data-bs-target="#modalEditarLiga"
                    (click)="cargarDatos(l)">
              <i class="bi bi-pencil-square"></i>
            </button>

            <button class="btn btn-danger btn-md"
                    title="Eliminar"
                    (click)="eliminarLiga(l.id)">
              <i class="bi bi-trash"></i>
            </button>

          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!--  CREAR LIGA -->
<div class="modal fade" id="modalCrearLiga" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header bg-corporativo">
        <h5 class="modal-title">Crear Nueva Liga</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">Nombre de la Liga</label>
            <input type="text" class="form-control" [(ngModel)]="nuevaLiga.nombre" name="nombreNueva" placeholder="Ej: Liga de Campeones">
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

        <button type="button" class="btn btn-nuevaLiga" (click)="guardarLiga()">Crear</button>
      </div>
    </div>
  </div>
</div>

<!--  EDITAR LIGA  -->
<div class="modal fade" id="modalEditarLiga" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Cabecera Roja -->
      <div class="modal-header bg-corporativo">
        <h5 class="modal-title">Editar Liga</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">Nombre de la Liga</label>
            <input type="text" class="form-control" [(ngModel)]="ligaEditada.nombre" name="nombreEditar">
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

        <button type="button" class="btn btn-ligas" (click)="actualizarLiga()">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL AÑADIR EQUIPOS  -->
<div class="modal fade" id="modalAddEquipos" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Inscribir Equipos en la Liga</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p class="text-muted">Selecciona los equipos que quieres añadir a <strong>{{ ligaSeleccionada?.nombre }}</strong>:</p>

        <form>
          <div class="mb-3">
            <label class="form-label fw-bold">Mis Equipos Disponibles</label>

            <select class="form-select" multiple size="8" [(ngModel)]="equiposSeleccionados" name="equiposSel">
              <option *ngFor="let equipo of equiposDisponibles" [value]="equipo.id">
                {{ equipo.nombre }}
              </option>
            </select>
            <div class="form-text text-danger mt-2">
              * Mantén pulsada la tecla <strong>Ctrl</strong> para seleccionar varios equipos a la vez.
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" (click)="guardarEquiposEnLiga()">
          <i class="bi bi-plus-circle"></i> Inscribir Equipos
        </button>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
