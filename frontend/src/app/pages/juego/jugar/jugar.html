<app-header></app-header>

<div class="container mt-5 mb-5" style="min-height: 60vh;">


  <div *ngIf="!pertenencia" class="text-center mt-5 d-flex flex-column align-items-center justify-content-center" style="height: 50vh;">
    <div class="spinner-border text-danger" style="width: 4rem; height: 4rem;" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <h4 class="mt-3 text-muted fw-bold">Cargando competición...</h4>
  </div>


  <div *ngIf="pertenencia" class="animate__animated animate__fadeIn">

    <!-- VISTA PRETEMPORADA -->
    <div *ngIf="!iniciada" class="pretemporada-container">

      <div class="text-center mb-5">
        <h6 class="text-uppercase text-muted ls-2">Panel de Administración</h6>
        <h1 class="display-4 fw-bold text-uppercase titulo-rojo">Pretemporada</h1>
        <p class="lead text-muted">Antes de comenzar, debes realizar las siguientes acciones</p>
        <div class="divider-negro mx-auto mt-3"></div>
      </div>

      <div class="row g-4 justify-content-center">
        <div class="col-md-5 col-lg-4">
          <div class="card h-100 shadow-sm border-0 card-setup">
            <div class="card-body text-center p-4">
              <div class="icon-circle mb-3 mx-auto"><i class="bi bi-calendar-week-fill"></i></div>
              <h4 class="fw-bold">1. Calendario</h4>
              <p class="text-muted small">Genera los enfrentamientos para todas las jornadas.</p>
              <div class="mb-4">
                <span class="badge rounded-pill" [ngClass]="enfrentamientos ? 'bg-success' : 'bg-warning text-dark'">
                  <i class="bi" [ngClass]="enfrentamientos ? 'bi-check-circle-fill' : 'bi-clock-fill'"></i>
                  {{ enfrentamientos ? 'Completado' : 'Pendiente' }}
                </span>
              </div>
              <button class="btn btn-setup w-100" [disabled]="enfrentamientos" (click)="generarEnfrentamientos()">
                {{ enfrentamientos ? 'Enfrentamientos Listos' : 'Generar Encuentros' }}
              </button>
            </div>
          </div>
        </div>

        <div class="col-md-5 col-lg-4">
          <div class="card h-100 shadow-sm border-0 card-setup">
            <div class="card-body text-center p-4">
              <div class="icon-circle mb-3 mx-auto"><i class="bi bi-robot"></i></div>
              <h4 class="fw-bold">2. Equipos Rivales</h4>
              <p class="text-muted small">Simula el mercado de fichajes.</p>
              <div class="mb-4">
                <span class="badge rounded-pill" [ngClass]="fichajesEquipos ? 'bg-success' : 'bg-warning text-dark'">
                  <i class="bi" [ngClass]="fichajesEquipos ? 'bi-check-circle-fill' : 'bi-clock-fill'"></i>
                  {{ fichajesEquipos ? 'Completado' : 'Pendiente' }}
                </span>
              </div>
              <button class="btn btn-setup w-100" [disabled]="fichajesEquipos" (click)="simularFichajes()">
                {{ fichajesEquipos ? 'Mercado Cerrado' : 'Simular Fichajes' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center mt-5 mb-5">
        <button class="btn btn-iniciar-liga btn-lg px-5 py-3 shadow"
                [disabled]="!enfrentamientos || !fichajesEquipos"
                (click)="iniciarLiga()">
          <i class="bi bi-play-circle-fill me-2"></i> COMENZAR LIGA
        </button>
      </div>
    </div>



    <!-- VISTA COMPETICIÓN (Liga iniciada) -->

    <div *ngIf="iniciada" class="competicion-container animate__animated animate__fadeIn">

      <div class="text-center mb-5">
        <h6 class="text-uppercase text-muted ls-2">Simulación de Liga</h6>
        <h1 class="display-3 fw-bold text-uppercase titulo-rojo">Jornada {{ jornada }}</h1>
        <div class="divider-negro mx-auto mt-3"></div>
      </div>


      <div class="row justify-content-center g-3 mb-5">


        <div class="col-md-4">

          <button *ngIf="!jornadaJugada"
                  (click)="simularJornada()"
                  class="btn btn-dark w-100 py-3 fw-bold shadow-sm btn-lg action-btn">
            <i class="bi bi-play-circle-fill text-danger me-2"></i> Simular Jornada
          </button>


          <button *ngIf="jornadaJugada"
                  (click)="terminarJornada()"
                  class="btn btn-success w-100 py-3 fw-bold shadow-sm btn-lg action-btn animate__animated animate__pulse">
            Continuar <i class="bi bi-arrow-right-circle-fill ms-2"></i>
          </button>
        </div>

        <div class="col-md-4">
          <button [routerLink]="['/clasificacion', idLiga]" class="btn btn-outline-dark w-100 py-3 fw-bold shadow-sm btn-lg action-btn">
            <i class="bi bi-trophy-fill text-warning me-2"></i> Consultar Clasificación
          </button>
        </div>

        <div class="col-md-4">
          <button [routerLink]="['/ligasJuego', idLiga]" class="btn btn-outline-secondary w-100 py-3 fw-bold shadow-sm btn-lg action-btn">
            <i class="bi bi-gear-fill me-2"></i> Administración
          </button>
        </div>
      </div>


      <div class="card shadow border-0 overflow-hidden">
        <div class="card-header bg-dark text-white text-center py-3">
          <h5 class="m-0 text-uppercase fw-bold letter-spacing-1">
            {{ jornadaJugada ? 'Resultados Finales' : 'Próximos Encuentros' }}
          </h5>
        </div>

        <div class="card-body p-0">


          <ng-container *ngIf="!jornadaJugada">
            <ng-container *ngFor="let item of encuentros">

              <div *ngIf="item.jornada == jornada" class="table-responsive">
                <table class="table table-striped table-hover m-0 align-middle">
                  <thead class="bg-light text-muted small text-uppercase">
                  <tr>
                    <th class="text-end w-40 py-3">Local</th>
                    <th class="text-center w-20 py-3">Horario</th>
                    <th class="text-start w-40 py-3">Visitante</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let partido of item.partidos">
                    <td class="text-end fw-bold py-3">{{ partido.local }}</td>
                    <td class="text-center bg-white border-start border-end">
                      <span class="badge bg-danger rounded-pill px-3 py-2 shadow-sm">VS</span>
                    </td>
                    <td class="text-start fw-bold py-3">{{ partido.visitante }}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </ng-container>

            <div *ngIf="encuentros.length === 0" class="text-center p-5 text-muted">
              <p>Cargando enfrentamientos...</p>
            </div>
          </ng-container>


          <ng-container *ngIf="jornadaJugada">
            <ng-container *ngFor="let item of resultados">

              <div class="table-responsive animate__animated animate__fadeIn">


                <table class="table table-striped table-hover m-0 align-middle w-100" style="table-layout: fixed;">

                  <thead class="bg-light text-muted small text-uppercase">
                  <tr>

                    <th class="text-end py-3" style="width: 40%;">Local</th>
                    <th class="text-center py-3" style="width: 20%;">Marcador</th>
                    <th class="text-start py-3" style="width: 40%;">Visitante</th>
                  </tr>
                  </thead>

                  <tbody>
                  <tr *ngFor="let partido of item.partido">


                    <td class="text-end fw-bold py-3 text-truncate pe-3"
                        [class.text-danger]="partido.golesLocal > partido.golesVisitante"
                        [class.text-muted]="partido.golesLocal < partido.golesVisitante"
                        [title]="partido.local.nombre">
                      {{ partido.local.nombre }}
                    </td>


                    <td class="text-center bg-white border-start border-end">
                      <div class="fs-4 fw-bold text-dark animate__animated animate__flipInX">
                        {{ partido.golesLocal }} - {{ partido.golesVisitante }}
                      </div>
                    </td>


                    <td class="text-start fw-bold py-3 text-truncate ps-3"
                        [class.text-danger]="partido.golesVisitante > partido.golesLocal"
                        [class.text-muted]="partido.golesVisitante < partido.golesLocal"
                        [title]="partido.visitante.nombre">
                      {{ partido.visitante.nombre }}
                    </td>

                  </tr>
                  </tbody>
                </table>

              </div>

            </ng-container>
          </ng-container>

        </div>
      </div>
    </div>

  </div>
</div>

<app-footer></app-footer>
